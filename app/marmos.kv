#:kivy 2.1.0

# Import Python classes to be used in KV
#:import SplashScreen app.screens.splash_screen.SplashScreen
#:import WiFiStatusScreen app.screens.wifi_status_screen.WiFiStatusScreen
#:import WiFiQRScreen app.screens.wifi_qr_screen.WiFiQRScreen
#:import HomeScreen app.screens.home_screen.HomeScreen
#:import MeatQRScreen app.screens.meat_qr_screen.MeatQRScreen
#:import ResultScreen app.screens.result_screen.ResultScreen
#:import ErrorScreen app.screens.error_screen.ErrorScreen
#:import CameraService app.services.camera_service.CameraService

# -------------------------------------------------------------------
# Global Styles & Constants
# -------------------------------------------------------------------
<Label>:
    font_name: 'Roboto' # Using Roboto as a stand-in for Work Sans
    color: 0.2, 0.2, 0.2, 1
    text_size: self.width, None
    halign: 'center'
    valign: 'middle'

<Button>:
    font_name: 'Roboto'
    background_color: 0.1, 0.4, 0.7, 1 # A strong blue for primary actions
    background_normal: ''
    background_down: ''
    color: 1, 1, 1, 1
    font_size: '20sp'
    size_hint_y: None
    height: '50dp'
    border: 3, 3, 3, 3

<BigButton@Button>:
    font_size: '24sp'
    height: '80dp'
    
<Screen>:
    background_color: 0.95, 0.95, 0.95, 1 # A light gray background for all screens

# -------------------------------------------------------------------
# Screen Manager
# -------------------------------------------------------------------
ScreenManager:
    id: screen_manager
    SplashScreen:
        name: 'splash_screen'
    WiFiStatusScreen:
        name: 'wifi_status_screen'
    WiFiQRScreen:
        name: 'wifi_qr_screen'
    HomeScreen:
        name: 'home_screen'
    MeatQRScreen:
        name: 'meat_qr_screen'
    ResultScreen:
        name: 'result_screen'
    ErrorScreen:
        name: 'error_screen'

# -------------------------------------------------------------------
# Screen Definitions
# -------------------------------------------------------------------

<SplashScreen>:
    canvas.before:
        Color:
            rgba: 0, 0, 0, 1 # Black background
        Rectangle:
            pos: self.pos
            size: self.size
    Image:
        source: 'app/assets/images/logo_marmos.png' # Assuming this path is correct
        size_hint: None, None
        size: '250dp', '250dp'
        pos_hint: {'center_x': 0.5, 'center_y': 0.5}
        allow_stretch: True

<WiFiStatusScreen>:
    BoxLayout:
        orientation: 'vertical'
        padding: '30dp'
        spacing: '20dp'
        pos_hint: {'center_x': 0.5, 'center_y': 0.5}

        Label:
            text: 'Status da Conexão Wi-Fi'
            font_size: '28sp'
            size_hint_y: 0.3
            color: 0.1, 0.1, 0.1, 1

        Label:
            id: status_label
            text: 'Conectado' if root.is_connected else 'Não Conectado'
            font_size: '22sp'
            color: (0.2, 0.7, 0.2, 1) if root.is_connected else (0.8, 0.2, 0.2, 1)
            size_hint_y: 0.2

        BoxLayout:
            orientation: 'vertical'
            spacing: '15dp'
            size_hint_y: 0.5
            
            BigButton:
                text: 'Configurar Wi-Fi'
                on_press: app.root.current = 'wifi_qr_screen'
            
            Button:
                text: 'Usar Offline'
                background_color: 0.5, 0.5, 0.5, 1
                on_press: app.root.current = 'home_screen'


<WiFiQRScreen>:
    BoxLayout:
        orientation: 'vertical'
        
        CameraService:
            id: camera_service
            allow_stretch: True
            
        Label:
            text: 'Aponte para o QR Code da rede Wi-Fi'
            size_hint_y: None
            height: '60dp'
            background_color: 0.1, 0.1, 0.1, 0.8
            canvas.before:
                Color:
                    rgba: self.background_color
                Rectangle:
                    pos: self.pos
                    size: self.size
            color: 1, 1, 1, 1

        Button:
            text: 'Cancelar'
            size_hint_y: None
            height: '60dp'
            background_color: 0.8, 0.2, 0.2, 1
            on_press: root.go_back()

<HomeScreen>:
    BoxLayout:
        orientation: 'vertical'
        padding: '30dp'
        spacing: '40dp'

        Image:
            source: 'app/assets/images/logo_marmos.png'
            size_hint_y: 0.3
            allow_stretch: True
            
        BoxLayout:
            orientation: 'vertical'
            spacing: '20dp'
            size_hint_y: 0.7
            pos_hint: {'center_x': 0.5}
            
            BigButton:
                text: 'Iniciar Leitura da Carne'
                on_press: app.root.current = 'meat_qr_screen'
            
            Button:
                text: 'Configurar Wi-Fi'
                background_color: 0.5, 0.5, 0.5, 1
                on_press: app.root.current = 'wifi_status_screen'

<MeatQRScreen>:
    BoxLayout:
        orientation: 'vertical'
        
        CameraService:
            id: camera_service
            allow_stretch: True
            
        Label:
            text: 'Posicione o QR Code da carne'
            size_hint_y: None
            height: '60dp'
            background_color: 0.1, 0.1, 0.1, 0.8
            canvas.before:
                Color:
                    rgba: self.background_color
                Rectangle:
                    pos: self.pos
                    size: self.size
            color: 1, 1, 1, 1

        Button:
            text: 'Cancelar'
            size_hint_y: None
            height: '60dp'
            background_color: 0.8, 0.2, 0.2, 1
            on_press: root.go_to_home()

<ResultScreen>:
    BoxLayout:
        orientation: 'vertical'
        padding: '30dp'
        spacing: '20dp'
        
        Label:
            id: title_label
            text: root.title
            font_size: '32sp'
            bold: True
            size_hint_y: 0.3
            
        Label:
            id: message_label
            text: root.message
            font_size: '22sp'
            size_hint_y: 0.4
            markup: True
            
        BigButton:
            text: 'Voltar ao Início'
            on_press: root.go_to_home()
            size_hint_y: 0.3
            pos_hint: {'center_x': 0.5}

<ErrorScreen>:
    BoxLayout:
        orientation: 'vertical'
        padding: '30dp'
        spacing: '20dp'

        Label:
            text: "Ocorreu um Erro"
            font_size: '32sp'
            bold: True
            color: 0.8, 0.2, 0.2, 1
            size_hint_y: 0.3

        Label:
            id: error_message_label
            font_size: '22sp'
            size_hint_y: 0.4

        BoxLayout:
            orientation: 'vertical'
            spacing: '15dp'
            size_hint_y: 0.3
            
            BigButton:
                text: 'Tentar Novamente'
                on_press: root.retry_action()
            
            Button:
                text: 'Voltar ao Início'
                background_color: 0.5, 0.5, 0.5, 1
                on_press: root.go_to_home()
